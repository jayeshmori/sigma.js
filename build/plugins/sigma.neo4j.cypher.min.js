module.exports=function(a){"use strict";if("undefined"==typeof a)throw"sigma is not declared";a.utils.pkg("sigma.neo4j"),a.utils.pkg("sigma.utils"),a.neo4j.send=function(b,c,d,e,f){var g,h,i,j=a.utils.xhr();if(g=b,"object"==typeof b&&(g=b.url,h=b.user,i=b.password),!j)throw"XMLHttpRequest not supported, cannot load the file.";g+=c,j.open(d,g,!0),h&&i&&j.setRequestHeader("Authorization","Basic "+btoa(h+":"+i)),j.setRequestHeader("Accept","application/json"),j.setRequestHeader("Content-type","application/json; charset=utf-8"),j.onreadystatechange=function(){4===j.readyState&&f(JSON.parse(j.responseText))},j.send(e)},a.neo4j.cypher_parse=function(a){var b,c={nodes:[],edges:[]},d={},e={};a.results[0].data.forEach(function(a){a.graph.nodes.forEach(function(a){var b={id:a.id,label:a.id,x:Math.random(),y:Math.random(),size:1,color:"#000000",neo4j_labels:a.labels,neo4j_data:a.properties};b.id in d||(d[b.id]=b)}),a.graph.relationships.forEach(function(a){var b={id:a.id,label:a.type,source:a.startNode,target:a.endNode,color:"#7D7C8E",neo4j_type:a.type,neo4j_data:a.properties};b.id in e||(e[b.id]=b)})});for(b in d)c.nodes.push(d[b]);for(b in e)c.edges.push(e[b]);return c},a.neo4j.cypher=function(b,c,d,e){var f,g,h="/db/data/transaction/commit";f=JSON.stringify({statements:[{statement:c,resultDataContents:["graph"],includeStats:!1}]}),g=function(b){return function(c){var e={nodes:[],edges:[]};e=a.neo4j.cypher_parse(c),d instanceof a?(d.graph.clear(),d.graph.read(e)):"object"==typeof d?(d=new a(d),d.graph.read(e),d.refresh()):"function"==typeof d&&(b=d,d=null),b&&b(d||e)}},a.neo4j.send(b,h,"POST",f,g(e))},a.neo4j.getLabels=function(b,c){a.neo4j.send(b,"/db/data/labels","GET",null,c)},a.neo4j.getTypes=function(b,c){a.neo4j.send(b,"/db/data/relationship/types","GET",null,c)}};