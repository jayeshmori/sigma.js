module.exports=function(a){"use strict";function b(){var b=this;this.init=function(b,d){if(d=d||{},this.sigInst=b,this.config=a.utils.extend(d,c),this.easing=d.easing,this.duration=d.duration,d.nodes&&(this.nodes=d.nodes,delete d.nodes),!a.plugins||"undefined"==typeof a.plugins.animate)throw new Error("sigma.plugins.animate is not declared");this.running=!1},this.atomicGo=function(){if(!this.running||this.iterCount<1)return!1;var a,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w=this.nodes||this.sigInst.graph.nodes(),x=w.length,y=1/0,z=-(1/0),A=1/0,B=-(1/0);for(this.iterCount--,this.running=!1,a=0;a<x;a++)c=w[a],c.dn.dx=0,c.dn.dy=0,y=Math.min(y,c.dn_x-(c.dn_size*b.config.scaleNodes+b.config.nodeMargin)),z=Math.max(z,c.dn_x+(c.dn_size*b.config.scaleNodes+b.config.nodeMargin)),A=Math.min(A,c.dn_y-(c.dn_size*b.config.scaleNodes+b.config.nodeMargin)),B=Math.max(B,c.dn_y+(c.dn_size*b.config.scaleNodes+b.config.nodeMargin));for(e=z-y,f=B-A,g=(y+z)/2,h=(A+B)/2,y=g-b.config.permittedExpansion*e/2,z=g+b.config.permittedExpansion*e/2,A=h-b.config.permittedExpansion*f/2,B=h+b.config.permittedExpansion*f/2,i={},j=0;j<b.config.gridSize;j++)for(i[j]={},k=0;k<b.config.gridSize;k++)i[j][k]=[];for(a=0;a<x;a++)for(c=w[a],s=c.dn_x-(c.dn_size*b.config.scaleNodes+b.config.nodeMargin),t=c.dn_x+(c.dn_size*b.config.scaleNodes+b.config.nodeMargin),u=c.dn_y-(c.dn_size*b.config.scaleNodes+b.config.nodeMargin),v=c.dn_y+(c.dn_size*b.config.scaleNodes+b.config.nodeMargin),l=Math.floor(b.config.gridSize*(s-y)/(z-y)),m=Math.floor(b.config.gridSize*(t-y)/(z-y)),n=Math.floor(b.config.gridSize*(u-A)/(B-A)),o=Math.floor(b.config.gridSize*(v-A)/(B-A)),k=l;k<=m;k++)for(j=n;j<=o;j++)i[j][k].push(c.id);for(p={},j=0;j<b.config.gridSize;j++)for(k=0;k<b.config.gridSize;k++)i[j][k].forEach(function(a){for(p[a]||(p[a]=[]),q=Math.max(0,j-1);q<=Math.min(j+1,b.config.gridSize-1);q++)for(r=Math.max(0,k-1);r<=Math.min(k+1,b.config.gridSize-1);r++)i[q][r].forEach(function(b){b!==a&&p[a].indexOf(b)===-1&&p[a].push(b)})});for(a=0;a<x;a++)d=w[a],p[d.id].forEach(function(a){var c=b.sigInst.graph.nodes(a),g=c.dn_x-d.dn_x,h=c.dn_y-d.dn_y,i=Math.sqrt(g*g+h*h),j=i<d.dn_size*b.config.scaleNodes+b.config.nodeMargin+(c.dn_size*b.config.scaleNodes+b.config.nodeMargin);j&&(b.running=!0,i>0?(c.dn.dx+=g/i*(1+d.dn_size),c.dn.dy+=h/i*(1+d.dn_size)):(c.dn.dx+=.01*e*(.5-Math.random()),c.dn.dy+=.01*f*(.5-Math.random())))});for(a=0;a<x;a++)c=w[a],c.fixed||(c.dn_x=c.dn_x+.1*c.dn.dx*b.config.speed,c.dn_y=c.dn_y+.1*c.dn.dy*b.config.speed);return this.running&&this.iterCount<1&&(this.running=!1),this.running},this.go=function(){for(this.iterCount=this.config.maxIterations;this.running;)this.atomicGo();this.stop()},this.start=function(){if(!this.running){var a=this.sigInst.graph.nodes(),c=this.sigInst.renderers[b.config.rendererIndex].options.prefix;this.running=!0;for(var d=0;d<a.length;d++)a[d].dn_x=a[d][c+"x"],a[d].dn_y=a[d][c+"y"],a[d].dn_size=a[d][c+"size"],a[d].dn={dx:0,dy:0};e[b.sigInst.id].dispatchEvent("start"),this.go()}},this.stop=function(){var c=this.sigInst.graph.nodes();if(this.running=!1,this.easing)e[b.sigInst.id].dispatchEvent("interpolate"),a.plugins.animate(b.sigInst,{x:"dn_x",y:"dn_y"},{easing:b.easing,onComplete:function(){b.sigInst.refresh();for(var a=0;a<c.length;a++)c[a].dn=null,c[a].dn_x=null,c[a].dn_y=null;e[b.sigInst.id].dispatchEvent("stop")},duration:b.duration});else{for(var d=0;d<c.length;d++)c[d].x=c[d].dn_x,c[d].y=c[d].dn_y;this.sigInst.refresh();for(var d=0;d<c.length;d++)c[d].dn=null,c[d].dn_x=null,c[d].dn_y=null;e[b.sigInst.id].dispatchEvent("stop")}},this.kill=function(){this.sigInst=null,this.config=null,this.easing=null}}if("undefined"==typeof a)throw new Error("sigma is not declared");a.utils.pkg("sigma.layout.noverlap");var c={speed:3,scaleNodes:1.2,nodeMargin:5,gridSize:20,permittedExpansion:1.1,rendererIndex:0,maxIterations:500},d={},e={};a.prototype.configNoverlap=function(c){var f=this;if(!c)throw new Error('Missing argument: "config"');return d[f.id]||(d[f.id]=new b,e[f.id]={},a.classes.dispatcher.extend(e[f.id]),f.bind("kill",function(){d[f.id].kill(),d[f.id]=null,e[f.id]=null})),d[f.id].init(f,c),e[f.id]},a.prototype.startNoverlap=function(a){var b=this;return a&&this.configNoverlap(b,a),d[b.id].start(),e[b.id]},a.prototype.isNoverlapRunning=function(){var a=this;return!!d[a.id]&&d[a.id].running}};